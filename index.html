<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <title>Robo Judge</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main>
    <header>
      <h1>Robo Judge</h1>
      <p class="sub">USAPL depth helper — on-device</p>
    </header>

    <section id="video-wrap">
      <video id="video" playsinline muted></video>
      <canvas id="stage"></canvas>

      <div id="recbar">
        <button id="recBtn">● REC</button>
        <button id="stopBtn" disabled>■ STOP</button>
        <a id="dlLink" download="robo-judge-set.webm" style="display:none">Download</a>
      </div>
    </section>

    <section id="controls">
      <div class="row">
        <label>Tolerance: <span id="tolVal">0.02</span></label>
        <input type="range" min="0" max="0.06" step="0.005" value="0.02" id="tol">
        <label>Smoothing: <span id="smVal">5</span></label>
        <input type="range" min="1" max="15" step="1" value="5" id="smooth">
        <label>Accuracy:</label>
        <select id="accuracy">
          <option value="1">Fast</option>
          <option value="2" selected>High</option>
        </select>
      </div>
      <div class="row">
        <label>Camera:</label>
        <select id="camera"></select>
        <button id="flip">Flip</button>
        <label>Or analyze a recorded video:</label>
        <input type="file" id="file" accept="video/*">
      </div>
      <div class="row">
        <button id="barbellBtn">🎯 Set Barbell Tracker</button>
        <span class="hint">Tap the barbell knurl in the video to initialize.</span>
      </div>
      <div class="row tips">
        Tips: true side view • hips+knees visible • 8–12ft away • good lighting • avoid black-on-black
      </div>
    </section>

    <section id="dashboard">
      <h2>Dashboard</h2>
      <div class="grid">
        <div class="card">
          <h3>Depth</h3>
          <div id="depthStatus">—</div>
          <div class="muted">Hip–Knee margin</div>
          <div id="margin">— cm</div>
        </div>
        <div class="card">
          <h3>Angles</h3>
          <div class="muted">Left Knee / Right Knee</div>
          <div id="kneeAngles">—° / —°</div>
          <div class="muted">Left Hip / Right Hip</div>
          <div id="hipAngles">—° / —°</div>
        </div>
        <div class="card">
          <h3>Barbell Velocity</h3>
          <div class="muted">Instant</div>
          <div id="velInstant">— m/s</div>
          <div class="muted">Rep Peak</div>
          <div id="velPeak">— m/s</div>
        </div>
        <div class="card">
          <h3>Status</h3>
          <div id="status">Ready</div>
        </div>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/pose.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3/drawing_utils.js"></script>
  <script src="app.js"></script>
</body>
</html>
